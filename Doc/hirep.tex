\documentclass{article}[12pt]

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}

\def\bfx{{\bf x}}

\bibliographystyle{JHEP}

\begin{document}


\section{Notation}
This section summarizes the main formulae that are used for
implementing the HMC for dynamical Wilson fermions in higher
representations. The Dirac operator is constructed following 
Ref.~\cite{Luscher:1996sc}, but using Hermitian generators 
%
\begin{equation}
T^{a\dagger}=T^a.
\end{equation}
%
For the fundamental representation, the normalization of the
generators is such that:
%
\begin{equation}
\mathrm{tr } \left(T^a T^b \right) = \frac12 \delta^{ab}.
\end{equation}
%
For a generic representation $R$, we define:
%
\begin{eqnarray}
\mathrm{tr }_R \left(T^a T^b \right) &=& T_R \delta^{ab}, \\
\sum_a \left(T^a T^a \right)_{AB} &=& C_2(R) \delta_{AB},
\end{eqnarray}
%
which implies: 
%
\begin{equation}
T_R = \frac{1}{N^2-1} C_2(R) d_R
\end{equation}
%
where $d_R$ is the dimension of the representation $R$.
The relevant group factors may be computed from the Young tableaux of the
representation of $SU(N)$ by using the formula:
%
\begin{equation}
C_2(R) =\frac{1}{2}\left(nN+ \sum_{i=1}^{m} n_i \left( n_i+1-2i
\right) - \frac{n^2}{N}\right)
\end{equation}
%
where $n$ is the number of boxes in the diagram, $i$ ranges over the
rows of the Young tableau, $m$ is the number of rows, and $n_i$ is the
number of boxes in the $i$-th row. 

\begin{table}[htp]
\begin{center}
\caption{Group invariants}
\label{table1}
\begin{tabular}{r|c|c|c}
R    & $d_R$               & $T_R$           & $C_2(R)$            \\
\hline
fund & $N$                 & $\frac12$       & $\frac{N^2-1}{2 N}$ \\        
Adj  & $N^2-1$             & $N$             & $N$ \\
2S   & $\frac{1}{2}N(N+1)$ & $\frac{N+2}{2}$ & $C_2(f) \frac{2(N+2)}{N+1}$ \\
2AS  & $\frac{1}{2}N(N-1)$ & $\frac{N-2}{2}$ & $C_2(f)
\frac{2(N-2)}{N-1}$ \\
\hline
\end{tabular}
\end{center}
\end{table}

\noindent
A generic element of the algebra is written as: $X=i X^a T^a$, and the
scalar product of two elements of the algebra is defined as:
%
\begin{equation}
(X,Y)= \mathrm{tr\ } \left(X^\dagger Y\right) = T_f X^a Y^a,
\end{equation}
%
\begin{equation}
\Vert X \Vert^2 = \mathrm{tr } \left(X^\dagger X\right)
 = \sum_{ij} \left| X_{ij} \right|^2
\end{equation}

\section{The Dirac operator}
The massless Dirac operator is written as in Ref.~\cite{Luscher:1996sc}:
%
\begin{equation}
D = \frac12 \left\{\gamma_\mu \left(\nabla_\mu + \nabla^*_\mu \right) 
- \nabla^*_\mu \nabla_\mu \right\}
\end{equation}
%
with
%
\begin{eqnarray}
\nabla_\mu\phi(x) &=& U^R (x,\mu)\phi(x+\mu) - \phi(x) \\
\nabla_\mu^*\phi(x) &=& \phi(x) - U^R (x-\mu,\mu)^\dagger\phi(x-\mu)
\end{eqnarray}
%
and therefore the action of the massive Dirac operator yields:
%
\begin{eqnarray}
D_m \phi(x) &=& (D+m) \phi(x) \nonumber \\
&=& - \frac12 \left\{ \left(1-\gamma_\mu\right) U^R(x,\mu) \phi(x+\mu) +
\left(1+\gamma_\mu\right) U^R(x-\mu,\mu)^\dagger \phi(x-\mu) - \right. 
\nonumber \\
& & \left. -(8+2m) \phi(x) \right\}, \label{DM}
\end{eqnarray}
%
where $U^R$ are the link variables in the representation $R$.

Rescaling the fermion fields by
$\sqrt{\kappa}=\left(\frac{2}{8+2m}\right)^{1/2}$, we can write the
fermionic action as:
%
\begin{equation}
S_f = \sum_{x,y} \phi^\dagger(x) D_m(x,y) \phi(y), 
\end{equation}
%
where
%
\begin{equation}
D_m(x,y) = \delta_{x,y} - \frac{\kappa}{2}
\left[(1-\gamma_\mu) U^R(x,\mu) \delta_{y,x+\mu} + 
(1+\gamma_\mu) U^R(x-\mu,\mu)^\dagger \delta_{y,x-\mu} \right],
\end{equation}
%
and the Hermitian Dirac operator is obtained as:
%
\begin{equation}
Q_m = \gamma_5 D_m. \label{QM}
\end{equation}
The fermionic determinant in the path integral can be represented by
introducing complex pseudofermionic fields:
\begin{equation}
\left(\det D_m\right)^{N_f} = 
\int \mathcal D \phi \mathcal D \phi^\dagger e^{-\phi^\dagger
  Q_m^{-N_f} \phi} \equiv
\int \mathcal D \phi \mathcal D \phi^\dagger e^{-S_\mathrm{pf}}.
\end{equation}

\section{Force for the HMC molecular dynamics} \label{SHMC}
The HMC Hamiltonian is given by:
\begin{equation}
\mathcal{H}=\mathcal{H}_\pi+\mathcal{H}_G+\mathcal{H}_F \, ,
\end{equation}
where
\begin{eqnarray}
\mathcal{H}_\pi &=& \frac{1}{2} \sum_{x,\mu} ( \pi(x,\mu) , \pi(x,\mu) ) = \frac{1}{2} T_f \sum_{a,x,\mu} \pi^a(x,\mu)^2 \, ,\\
\mathcal{H}_G &=& \beta \sum_{\mu<\nu} \left( 1- \frac{1}{N} \mathrm{Re\ tr\ } \mathcal{P}_{\mu\nu}\right) \, ,\\
\mathcal{H}_F &=& \phi^\dagger ( Q_m^2 - \beta )^{-l} \phi \, , \,\,\,\, l=\frac{N_f}{2}>0 \, , \label{HF}
\end{eqnarray}
and we have introduced for each link variable a conjugate momentum in the algebra of the gauge group: $\pi(x,\mu)=i \pi^a(x,\mu) T_f^a$.
In the expression of $\mathcal{H}_F$ we omitted the sum over position, spin and color indices and we have also introduced an arbitrary shift $\beta$ for the matrix $Q_m^2$, as this will be useful in the discussion
for the RHMC algorithm.

The equation of motion for the link variables are given by (the $\dot{\square}$ indicates the derivative with respect to the molecular dynamics time):
\begin{equation}
\dot U(x\mu) = \pi(x,\mu) U(x,\mu)\, ,
\end{equation}
while the equation of motion for the momenta can be obtain as follows from the requirement that the hamiltonian
$\mathcal{H}$ is a conserved quantity:
\begin{equation}
0 = \dot{\mathcal{H}} = \dot{\mathcal{H}}_\pi + \dot{\mathcal{H}}_G + \dot{\mathcal{H}_F} \, . \label{HCONS}
\end{equation}

For the first two derivatives we have:
\begin{eqnarray}
\dot{\mathcal{H}}_\pi &=& \sum_{x,\mu} ( \pi(x,\mu) , \dot\pi(x,\mu) ) = T_f \sum_{x,\mu} \sum_a \pi^a(x,\mu) \dot\pi^a(x,\mu) \, \label{HDOTPI}\\
		\dot{\mathcal{H}}_G &=& \sum_{x,\mu} -\frac{\beta}{N} \mathrm{Re\ tr\ } \left[ \dot U(x,\mu) V^\dagger(x,\mu) \right] = \nonumber \\
	&=& \sum_{x,\mu} -\frac{\beta}{N} \mathrm{Re\ tr\ } \left[ \pi(x,\mu) U(x,\mu) V^\dagger(x,\mu) \right] \nonumber = \\
	&=& \sum_{x,\mu} \sum_a -\frac{\beta}{N} \pi^a(x,\mu) \mathrm{Re\ tr\ } \left[ i T^a_f U(x,\mu) V^\dagger(x,\mu) \right] \, , \label{HDOTG}
\end{eqnarray}
where $V(x,\mu)$ is the sum of the staples around the link $U(x,\mu)$.

The computation of the fermionic force goes as follows. We only consider the case $l=1$ since this is the
only case relevant both for the HMC algorithm and the RHMC algorithm (see below). We have:
\begin{eqnarray}
\dot{\mathcal{H}}_F = -\ \phi^\dagger (Q_m^2 - \beta)^{-1} \dot{(Q_m^2)} (Q_m^2 - \beta)^{-1} \phi \, . \label{FF1}
\end{eqnarray}
Defining:
\begin{eqnarray}
\eta &=& (Q_m^2 - \beta)^{-1} \phi \, , \label{HMCETA}\\
\xi &=& Q_m \eta \, ,
\end{eqnarray}
and using the fact that the matrix $(Q_m^2-\beta)$ is hermitean, we can rewrite Eq.(\ref{FF1}) as
\begin{eqnarray}
\dot{\mathcal{H}}_F = - 2 \ \xi^\dagger \dot{(Q_m)} \eta \, . \label{FF2}
\end{eqnarray}
Inserting the explicit form of $Q_m$, Eq.s~(\ref{QM}) and (\ref{DM}), into Eq.(\ref{FF2}) we obtain
\begin{multline}
\dot{\mathcal{H}}_F = \mathrm{Re\ }\sum_{x,\mu} \xi(x)^\dagger \dot U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \eta(x+\mu) \\ 
+ \xi(x+\mu)^\dagger \dot U^R(x,\mu)^\dagger \gamma_5 (1+\gamma_\mu) \eta(x) = \nonumber 
\end{multline}
\begin{multline}
\phantom{\dot{\mathcal{H}}_F} = \mathrm{Re\ }\sum_{x,\mu} \xi(x)^\dagger \dot U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \eta(x+\mu) \\ 
+ \eta(x)^\dagger \dot U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \xi(x+\mu)
\end{multline}
where the sum over spin and color indices is intended and we made explicit the fact the the whole 
expression is real.
We now use the fact that 
\begin{equation}
\dot U^R (x,\mu) = \pi^R(x,\mu) U^R(x,\mu) = i \pi^a(x,\mu) T^a_R U^R(x,\mu) \label{URDOT}
\end{equation}
Notice that, since we define $T^a_R(x,\mu) = R_* T^a(x,\mu)$, the $\pi^a(x,\mu)$ in the above 
equation are the same as those appearing in the expressions for $\dot{\mathcal{H}}_{\pi,G}$.
Using Eq.(\ref{URDOT}) in the expression for $\dot{\mathcal{H}}_{F}$ we find
(capitalized $Tr$ indicates the trace over color \textit{and} spin indices as opposed to the lower
 case $tr$ which is the trace over color only)
\begin{multline}
\dot{\mathcal{H}}_F = \sum_{x,\mu} \sum_a \pi^a(x,\mu) \mathrm{Re\ Tr\ } \left[ iT^a_R U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \right. \\
		\left. \left\{ \eta(x+\mu)\otimes\xi(x)^\dagger + \xi(x+\mu)\otimes\eta(x)^\dagger \right\} \right] \, . \label{HDOTF}
\end{multline}

Inserting Eq.s~(\ref{HDOTPI}),(\ref{HDOTG}),(\ref{HDOTF}) into Eq.~(\ref{HCONS}) we obtain the equation of motion
for the momenta $\pi^a(x,\mu)$
\begin{align}
\dot\pi^a(x,\mu) &= \dot\pi^a_G(x,\mu) + \dot\pi^a_F(x,\mu) \, , \label{PIDOT1}\\
\dot\pi^a_G(x,\mu) &= \frac{\beta}{N} \frac{1}{T_f} \mathrm{Re\ tr\ } \left[ i T^a_f U(x,\mu) V^\dagger(x,\mu) \right] \, ,\label{PIDOT2}\\
\dot\pi^a_F(x,\mu) &=-\frac{1}{T_f} \mathrm{Re\ Tr\ } \left[ iT^a_R U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \right. \nonumber\\
										&\quad\quad\quad	\left. \left\{ \eta(x+\mu)\otimes\xi(x)^\dagger + \xi(x+\mu)\otimes\eta(x)^\dagger \right\} \right]\, . \label{PIDOT3}
\end{align}

For sake of convenience we introduce the following projectors $P^a_R$ over the algebra in the rapresentation $R$:
\begin{equation}
P^a_R ( F ) = - \frac{1}{T_R} \mathrm{Re\ tr\ } \left[ i T^a_R F \right] \, ,
\end{equation}
we can be used to rewrite Eq.s~(\ref{PIDOT2})-(\ref{PIDOT3}) in a more compact form:
\begin{align}
\dot\pi^a_G(x,\mu) &= - \frac{\beta}{N} P^a_f \left( U(x,\mu) V^\dagger(x,\mu) \right) \, ,\\
\dot\pi^a_F(x,\mu) &= \frac{T_R}{T_f} P^a_R \left( U^R(x,\mu) \mathrm{tr_{spin}} \left[ \gamma_5 (1-\gamma_\mu) \right. \right. \nonumber\\
										&\quad\quad\quad	\left. \left. \left\{ \eta(x+\mu)\otimes\xi(x)^\dagger + \xi(x+\mu)\otimes\eta(x)^\dagger \right\} \right] \right)\, . \label{HFFORCE}
\end{align}

\section{Checks of the MD force}
The formulae derived in the previous Section can be checked against two
known examples. The first, and almost trivial, check is obtained by
assuming that the representation $R$ is again the fundamental
representation. The well-known expression for the MD force for the
usual HMC is then recovered. 

The second case that has already been studied in the literature is the
case of fermions in the adjoint representationof the gauge group
SU($2$)~\cite{Donini:1996nr}. We agree with Eq.~(16) in
Ref.~~\cite{Donini:1996nr}, provided that we exchange the indices $a$
and $b$ in that formula.

\section{HMC Algorithm}

We briefly review the construction of the HMC algorithm \cite{??}.

Given the action $S(\phi)$ of a system of bosonic fields $\phi$, our goal is to generate a Markov process with 
fixed probability distribution $P_S(\phi) = 1/Z \exp[-S(\phi) ]$. A sufficient condition to have such a 
Markov process is that it is ergodic and it satifies detailed balance:
\begin{equation}
P_S(\phi)P_M(\phi\rightarrow \phi') = P_S(\phi')P_M(\phi' \rightarrow \phi) \, .
\end{equation}
We define $P_M(\phi \rightarrow \phi')$ with the following three-step process:
\begin{enumerate}
\item we expand the configuration space with additional fields, the ``momenta" $\pi$ randomly chosen with probability
$P_k(\pi)$ such that $P_k(\pi)=P_k(-\pi)$ -- usually one takes $P_k(\pi)\propto \exp[-\pi^2/2]$; 
\item in the extended configuration space $(\phi, \pi)$, we generate a new configuration $(\phi',\pi')$ with probability
$P_h((\phi,\pi)\rightarrow(\phi',\pi'))$ such that 
\[P_h((\phi,\pi)\rightarrow(\phi',\pi')) = P_h((\phi',-\pi')\rightarrow(\phi,-\pi))\]
(reversibility condition);
\item we accept the new configuration $\phi'$ with probability 
\[P_A((\phi,\pi)\rightarrow(\phi',\pi')) = min \left\{ 1, \frac{P_S(\phi')P_k(\pi')}{P_S(\phi)P_k(\pi)} \right\} \, .\]
\end{enumerate}
It is easy to see that the resulting probability
\begin{equation}
P_M(\phi\rightarrow\phi') = \int d\pi d\pi' P_k(\pi) P_h((\phi,\pi)\rightarrow(\phi',\pi')) P_A((\phi,\pi)\rightarrow(\phi',\pi')) \, ,
\end{equation}
satisfies detailed balance. Care must be taken to ensure ergodicity.

As already stated, the distribution $P_k(\pi)$ is generally taken to be gaussian (this should also garantee ergodicity).
The process $P_h$ is instead identified with the hamiltonian flow of a yet unspecified Hamiltonian $H$ in the phase
space $(\phi,\pi)$ (giving to $\pi$ the meaning of ``momenta"). The time reversal symmetry of classical dynamics equation of motion
garantees the reversibility condition. The resulting probability $P_h$ is then a delta function (the process is completly deterministic).
Numerical integration to a given accuracy will result in a broader distribution and care must be taken to garantee the reversibility condition 
in this case.
Since we want a high acceptance rate (low correlation among the configurations), we must carefully choose the Hamiltonian $H$.
One simple way is to take $P_k$ to be gaussian and to define $H(\pi,\phi)=-\ln [P_k(\pi) P_S(\phi)] = \pi^2/2 + S(\phi)$ 
(omitting irrelevant constants). If $H$ is exactly conserved by the process $P_h$ then the acceptance probability is 1.

When fermionic degrees of freedom are present in the action $S$, we can first integrate them out, resulting in a non
local bosonic action and then apply the above scheme. In practice, to deal with a non-local action is not convienent
from a numerical point a view and stocastic extimates are used.

Consider a quadratic fermionic term  in the action: $S(\bar\psi,\psi) = \bar\psi M \psi$ with a generic interaction
matrix $M(\phi)$ function of the bosonic fields $\phi$. The contribution of this term to the partition function
is $\int d\bar\psi d\psi \exp [ -S(\bar\psi,\psi)] = det[M(\phi)]$. 

Assuming that the matrix $M(\phi)$ is positive definite,
we can rewrite $det[M]=\int d\bar\eta d\eta \exp[ \bar\eta (M)^{-1} \eta ]$, where $\bar\eta$,$\eta$ are two new 
complex bosonic fields, called pseudofermions.
This term can be taken into account generating random pseudofermions $\bar\eta$, $\eta$ with the desidered probability
distribution and keeping then fixed during the above HMC configuration generation for the remaining bosonic fields $\phi$.



\section{RHMC formulation}

The fermionic part of the HMC hamiltonian, for $N_f$ degenerate 
quarks and $N_{pf}$ pseudofermions, can be written as:
%
\begin{equation}
\mathcal{H}_F = \sum_{k=1}^{N_{pf}} \phi_k^\dagger ( Q_m^2 )^{-l_k} \phi_k \,\, ;\,\, \sum_k l_k = \frac{N_f}{2}\, , \label{HFN}
\end{equation}
and $l_k>0$. For the sake of simplicity we will set all the $l_k$ to be equal:
\begin{equation}
\forall k,\,\, l_k = \frac{N_f}{2N_{pf}}\, .
\end{equation}

In the RHMC algorithm~\cite{Clark:2005sq} rational approximations are used whenever we need to take some 
fractional power of the positive definite fermion matrix $Q_m^2$.

In this implementation we use three different rational approximations.

The first one is used to approximate Eq.~(\ref{HFN}) (we need only one approximation because all $l_k$ are equal):
\begin{eqnarray}
\mathcal{H}_F &=& \sum_{k=1}^{N_{pf}} \phi_k^\dagger r_{a}( Q_m^2 )\phi_k \, , \label{HFRHMC}\\ 
( Q_m^2 )^{-\frac{N_f}{2N_{pf}}} \simeq r_{a}(Q_m^2) &=& \alpha_0^a + \sum_{n=1}^{d_{1}} \alpha_n^a ( Q^2_m - \beta_n^a )^{-1} \, .
\end{eqnarray}
Using the formulas derived in Section~\ref{SHMC}, it is easy to write the force corresponding to Eq.~(\ref{HFRHMC}).
In fact, Eq.~(\ref{HFRHMC}) is nothing but a sum of terms of the form Eq.~(\ref{HFRHMC}) once we put $l=1$, $\beta=\beta_n^a$.
The RHMC force will be then given by a sum over $n=1,\dots,d_1$ of terms given by Eq.(\ref{HFFORCE}) multiplied by a factor $\alpha_n^a$.
Notice that since $l=1$, to compute $\eta$ as in Eq.(\ref{HMCETA}) a simple shifted inversion is required.

The second rational approxmation is required in the heatbath update of pseudofermions.
In order to generate pseudofermions distributed as in Eq.~(\ref{HFN}), a simple two-step process is used.
For each pseudofermion we first generate a gaussian distributed field $\tilde\phi_k$:
\begin{equation}
P(\tilde\phi_k)\propto \exp [ -\tilde\phi_k^\dagger \tilde\phi_k ] \, ,
\end{equation}
and then we set:
\begin{equation}
\phi_k = (Q_m^2)^{\frac{l_k}{2}} \tilde\phi_k \, ,
\end{equation}
making use of the fact that $(Q_m^2)$ is hermitean (notice the plus sign in the exponent.) 
The RHMC algorithm uses a rational approximation to compute the above quantities (again we need only one 
approximation since all $l_k$ are equal):
\begin{eqnarray}
( Q_m^2 )^{\frac{l_k}{2}} \simeq r_{b}(Q_m^2) &=& \alpha_0^b + \sum_{n=1}^{d_{2}} \alpha_n^b ( Q^2_m - \beta_n^b )^{-1} \, .
\end{eqnarray}

The third rational approximation is used in the code for the Metropolis test.
Starting from Eq.~(\ref{HFN}), for each pseudofermion we can rewrite:
\begin{equation}
\phi_k^\dagger ( Q_m^2 )^{-l_k}\phi_k = \left\| (Q_m^2)^{-\frac{l_k}{2}} \phi_k \right\|^2\, ,
\end{equation}
where we used the property that $Q_m^2$ is hermitean.
The rational approximation needed in this case is:
\begin{eqnarray}
( Q_m^2 )^{-\frac{l_k}{2}} \simeq r_{c}(Q_m^2) &=& \alpha_0^c + \sum_{n=1}^{d_{3}} \alpha_n^c ( Q^2_m - \beta_n^c )^{-1} \, .
\end{eqnarray}
Notice that if $d_2=d_3$ the coefficients for the two approximations $r_b$ and $r_c$ can each be obtained from the other.

In order to compute the coefficients $\alpha_n$, $\beta_n$ appearing in the rational approximations 
the Remez algorithm is needed. In this implementation we do not compute those coefficients ``on the fly'', but rather
we use a precomputation step to generate a table of coefficients form which we pick up the right values when needed.
The generation of this table goes as follows.

First note that we need to compute rational approximations for a function $f(x)$ of the form $f(x)=x^l$ and the approximation
must be accurate over the spectral range of the operator $Q_m^2$.
To simplify the computation of the table we note that the following proposition holds:
if $f(x)$ is a homogeneous function of degree $l$ and $r(x)$ is an optimal (in the sense of relative error) 
rational approximation to $f(x)$ over the interval $[\epsilon,\mathrm{h}]$ to a given accuracy 
then $r(kx)/k^l$ is an optimal rational approximation for the same function and the same accuracy 
over the interval $[\epsilon/k,\mathrm{h}/k]$. Notice that the coefficients of the ``rescaled'' rational
approximation are easily obtained from that of the original approximation.
A simple corollary is that, given a homogeneuos function $f(x)$, we can divide the rational approximations
with the same accuracy in classes distinguished by the ratio $\epsilon/\mathrm{h}$; within each class
the coefficients of the rational approximations are easily related to each other, so that we only need
to compute one rational approximation in each class. This is what is done in our implementation.

In detail: we generate a table containing the coefficients for the rational approximations
 belonging in different classes distinguished by the function $f(x)$ which we want to approximate and 
 the accuracy which is required. We arbitrary set $\mathrm{h}$ to a fixed value equal to the absolute
 upper bound on the spectrum of the matrix $Q_m^2$. This choice fixes the representative of each class, 
because the lower bound of the approximation is now a function of $\mathrm{h}$.

At run-time this table is used to generate optimal rational approximations rescaling the 
precomputed coefficients to the desired interval containing the spectrum of the matrix $Q_m^2$.
This interval is obtained by computing the maximum and minimum eigenvalue of $Q_m^2$ on 
each configuration when needed. In our code we update this interval only before the 
metropolis test, while we keep it fixed during the molecular dinamics.


\section{Even-Odd preconditioning}
It is a very well know fact that the time spend for a simulation with dynamical fermions
is dominated by the time required for the inversions of the Dirac operator. 
The convergence of such inversions can be improved using an appropriate precondining.
The idea is to rewrite the fermionic determinant as a determinant 
(or product of determinants) of better conditioned matrix (matrices) than the original
Dirac operator.
For the non-improved Wilson action this can be easily done using the \textit{even-odd} 
preconditioning. We start rewriting the Dirac operator $D_m$ as a block matrix:
\begin{equation}
D_m = \begin{pmatrix}
4+m& D_{eo}\\
D_{oe} &4+m
\end{pmatrix}\,\,\, ,
\end{equation}
where each block has a dimension half that of the original Dirac matrix. The diagonal 
blocks connecting sites with the same parity are proportional to the identity matrix, 
while off-diagonal blocks connect sites with opposite parity. We have (since $D_m$
is $\gamma_5$-hermitean):
\begin{equation}
\gamma_5 D_{eo} \gamma_5 = D_{oe}^\dagger\,\, . 
\end{equation}
The determinant of the Dirac matrix $D_m$ can be rewritten as:
\begin{equation}
{\rm det\ } D_m = {\rm det\ } ( (4+m)^2 - D_{oe} D_{eo} ) = {\rm det\ } ( (4+m)^2 - D_{eo} D_{oe} ) \equiv {\rm det\ } D^{eo}_m\,\, , 
\end{equation}
using the well known formula for the determinant of a block matrix.
Since the determinant of $D_m$ and of $D_m^{eo}$ are the same the latter can be used 
in numercal simulations. Note that the even-odd preconditioned matrix only connects sites 
with the same parity thus it have only half of the size of the original Dirac matrix and 
as $D_m$ it is $\gamma_5$-hermitean. We define as before the hermitean matrix 
$Q_m^{eo}\equiv \gamma_5 D_m^{eo}$, which will be used in practice.

The formulation of the HMC algorithm does not change and the only difference is that pseudofermions fields 
are now only defined on half of the lattice sites, conventionally the even sites in what follows.
We now give the explicit expression for the fermionic force for the preconditioned system described by 
the hamiltonian:
\begin{eqnarray}
\mathcal{H}_F &=& \phi_e^\dagger ( (Q^{eo}_m)^2 - \beta )^{-1} \phi_e \,\, ,
\end{eqnarray}
where as before we are assuming $N_f=2$ or a rational approximation 
of the actual fractional power function, and where we made explicit that $\phi_e$ is 
only defined on even sites.
Eq.(\ref{FF2}) is unchanged :
\begin{eqnarray}
\dot{\mathcal{H}}_F = - 2 \ \xi_e^\dagger \dot{(Q^{eo}_m)} \eta_e \, ,\label{FFPRE}
\end{eqnarray}
where as before we have defined:
\begin{eqnarray}
\eta_e &=& ((Q^{eo}_m)^2 - \beta)^{-1} \phi_e \, , \\
\xi_e &=& Q^{eo}_m \eta_e \, .
\end{eqnarray}
The explicit form of $Q_m^{eo}$ must be used at this point. We have:
\begin{eqnarray}
\dot{(Q^{eo}_m)} = -\gamma_5 (\dot{D_{eo}} D_{oe} + D_{eo}\dot{D_{oe}} )\,\, .\label{QPREDOT}
\end{eqnarray}
Defining
\begin{eqnarray}
\sigma_o &=& D_{oe} \eta_e \, , \\
\rho_o &=& D_{oe} \xi_e \, ,
\end{eqnarray}
and inserting Eq.(\ref{QPREDOT}) into Eq.(\ref{FFPRE}), we find:
\begin{multline}
\dot{\mathcal{H}}_F =  - \sum_{\mu,x\in even} {\rm Tr}_{x,\mu}	\left[ \sigma_o(x+\mu)\otimes\xi_e(x)^\dagger + \rho_o(x+\mu)\otimes\eta_e(x)^\dagger \right] - \\
- \sum_{\mu,x\in odd} {\rm Tr}_{x,\mu}	\left[ \xi_e(x+\mu)\otimes\sigma_o(x)^\dagger + \eta_e(x+\mu)\otimes\rho_o(x)^\dagger \right] \label{FORPRE}
\end{multline}
and for convenience we use the shorthand notation:
\begin{equation}
{\rm Tr}_{x,\mu} \left[ \Phi \right] \equiv \mathrm{Re\ Tr\ } \left[ \dot U^R(x,\mu) \gamma_5 (1-\gamma_\mu) \Phi \right]\,\, .
\end{equation}
From Eq.(\ref{FORPRE}) it is clear that the fermionic force has a different expression on sites of different parities.
Proceeding as before we arrive at the final expressions. For $x\in even$:
\begin{align}
\dot\pi^a_F(x,\mu) &= - \frac{T_R}{T_f} P^a_R \left( U^R(x,\mu) \mathrm{tr_{spin}} \left[ \gamma_5 (1-\gamma_\mu) \right. \right. \nonumber\\
										&\quad\quad\quad	\left. \left. \left\{  \sigma_o(x+\mu)\otimes\xi_e(x)^\dagger + \rho_o(x+\mu)\otimes\eta_e(x)^\dagger \right\} \right] \right)\, ,
\end{align}
while for $x\in odd$:
\begin{align}
\dot\pi^a_F(x,\mu) &= - \frac{T_R}{T_f} P^a_R \left( U^R(x,\mu) \mathrm{tr_{spin}} \left[ \gamma_5 (1-\gamma_\mu) \right. \right. \nonumber\\
										&\quad\quad\quad	\left. \left. \left\{\xi_e(x+\mu)\otimes\sigma_o(x)^\dagger + \eta_e(x+\mu)\otimes\rho_o(x)^\dagger   \right\} \right] \right)\, .
\end{align}




\section{Conventions used in the code}

\subsection{Representations}

The hermitean generators $T^a_f$ for the fundamental representation used are of the form:
\begin{equation}
\begin{pmatrix} 
0&1&0&\dots\\
1&0&0&\dots\\
0&0&0&\dots\\
\hdotsfor{4}
\end{pmatrix}\, ,
\begin{pmatrix} 
0&i&0&\dots\\
-i&0&0&\dots\\
0&0&0&\dots\\
\hdotsfor{4}
\end{pmatrix}\, ,
\begin{pmatrix} 
1&0&0&\dots\\
0&1&0&\dots\\
0&0&-2&\dots\\
\hdotsfor{4}
\end{pmatrix}\, ,
\end{equation}
normalized so that $T_f=1/2$. The generators for the other representations 
will be obtained in the following.

We first give the explicit form for the representation functions $R$ which map 
$U\rightarrow U^R$. We define for each representation an orthonormal base $e_R$ for 
the appropriate vector space of matrices. 

For the Adjoint representation we define the base $e_{Adj}$ for the $N\times N$ 
traceless hemitean matrices to be $e_{Adj}^a=T^a_f/\sqrt{T_f}$, $a=1,\dots,N^2-1$ 
(i.e. proportional to the generators of the fundamental representation and 
normalized to 1.)

For the two-index Symmetric representation the base $e^{(ij)}_{S}$, with $i\le j$, for 
the $N\times N$ symmetric matrices is given by:
\begin{eqnarray}
i\neq j \, ,\,\,\,&e^{(ij)}_S&=\frac{1}{\sqrt{2}}\begin{pmatrix} 
0&1&0&\dots\\
1&0&0&\dots\\
0&0&0&\dots\\
\hdotsfor{4}
\end{pmatrix}\, , \\
i=j \, ,\,\,\,&e^{(ii)}_S&=\begin{pmatrix} 
0&0&0&\dots\\
0&1&0&\dots\\
0&0&0&\dots\\
\hdotsfor{4}
\end{pmatrix}\, , 
\end{eqnarray}
where the non zero entries are at position $(i,j)$, etc.

For the two-index Antisymmetric representation the base $e^{(ij)}_{AS}$, with $i<j$, for 
the $N\times N$ symmetric matrices is given by:
\begin{equation}
e^{(ij)}_{AS}=\frac{1}{\sqrt{2}}\begin{pmatrix} 
0&1&0&\dots\\
-1&0&0&\dots\\
0&0&0&\dots\\
\hdotsfor{4}
\end{pmatrix}\, , 
\end{equation}
where, as above, the non zero entries are at position $(i,j)$.

The maps $R$ are explicitly given by:
\begin{eqnarray}
(R^{Adj} U)_{ab} &=& U^{Adj}_{ab} = \mathrm{tr\ }\left[ e^a_{Adj} U e^b_{Adj} U^\dagger\right]\,\, , a,b=1,\dots,N^2-1\, ,\\ 
(R^{S} U)_{(ij)(lk)} &=& U^{S}_{(ij)(lk)} = \mathrm{tr\ }\left[ (e^{(ij)}_{S})^\dagger U e^{(lk)}_S U^T\right]\,\, , i\le j, l\le k\, ,\\ 
(R^{A} U)_{(ij)(lk)} &=& U^{A}_{(ij)(lk)} = \mathrm{tr\ }\left[ (e^{(ij)}_{A})^\dagger U e^{(lk)}_A U^T\right]\,\, , i< j, l< k\, .
\end{eqnarray}

The generators $T_R^a$ used are defined as the image of the generators in the fundamental
under the differential of the maps $R$ defined above: $T^a_R = R_* T^a_f$.
Explicit expression can easily be worked out form the definition above.
The invariants $T_R$ and $C_2(R)$ for the generators defined in this way are given in 
Table~(\ref{table1}).

\subsection{$\gamma$ matrices}
We use the chiral representation for the Dirac $\gamma$ matrices:
\begin{equation}
\gamma_\mu=
\begin{pmatrix}
0&e_\mu\\
e_\mu^\dagger&0
\end{pmatrix}\, ,
\end{equation}
where $e_\mu$ are $2\times 2$ matrices given by: $e_0=-1$, $e_k=-i\sigma_k$,
\begin{equation}
\sigma_1=
\begin{pmatrix}
0&1\\
1&0
\end{pmatrix},\,\,
\sigma_2=
\begin{pmatrix}
0&-i\\
i&0
\end{pmatrix},\,\,
\sigma_3=
\begin{pmatrix}
1&0\\
0&-1
\end{pmatrix}\, .
\end{equation}
We have:
\begin{equation}
\gamma_5=\gamma_0\gamma_1\gamma_2\gamma_3=
\begin{pmatrix}
1&0\\
0&-1
\end{pmatrix}\, .
\end{equation}



\section{Two--point functions}
This is a summary of the formulae used for the mesonic two--pt
functions. 

\bigskip

\noindent
Let $\Gamma$ and $\Gamma^\prime$ be two generic matrices in the
Clifford algebra, we define the two--pt function:
%
\begin{equation}
f_{\Gamma\Gamma^\prime}(t) = \sum_\bfx \langle \bar\psi(\bfx,t) \Gamma
\psi(\bfx,t) \bar\psi(0) \Gamma^\prime \psi(0) \rangle
\end{equation}
%
Performing the Wick contractions yields:
%
\begin{eqnarray}
\langle \bar\psi(\bfx,t) \Gamma
\psi(\bfx,t) \bar\psi(0) \Gamma^\prime \psi(0) \rangle &=&
- \mathrm{tr} \left[ \Gamma S(x-y) \Gamma^\prime S(y-x) \right] 
\nonumber \\
&=& - \mathrm{tr} \left[ \Gamma S(x-y) \Gamma^\prime \gamma_5 
S^\dagger(x-y) \gamma_5 \right] \nonumber 
\end{eqnarray}
%
In practice we invert the Hermitean Dirac operator $\gamma_5 D$ by
solving the equation:
%
\begin{equation}
Q_{AB}(x-y) \eta^{\bar A,x_0}_B(y) = \delta_{A,\bar A} \delta_{x,x_0}
\end{equation}
%
where $A=\{a,\alpha\}$ is a collective index for colour and spin, and
$\bar A$, $x_0$ are the position of the source for the inverter. 

Using the field $\eta$ that we obtain from the inverter, the
correlator above becomes:
%
\begin{equation}
\langle \ldots \rangle = - \tilde \Gamma_{AB} \eta^{C,y}_B(x)
\tilde \Gamma^\prime_{CD} \eta^{D,y}_A(x)^*
\end{equation}
where $\tilde \Gamma= \gamma_5 \Gamma$, and $\tilde \Gamma^\prime =
\gamma_5 \Gamma^\prime$.

\bibliography{hirep}

\end{document}
